"use strict";const s=require("electron"),d=require("fs"),g=require("net");function f(t){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const e in t)if(e!=="default"){const o=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,o.get?o:{enumerable:!0,get:()=>t[e]})}}return r.default=t,Object.freeze(r)}const m=f(d),l=require("pdfmake/build/pdfmake"),h=require("pdfmake/build/vfs_fonts");l.vfs=h.pdfMake.vfs;let c=null;const y=5e3;function O(t){const r={"Bß║»t":"Bat","─æß║ºu":"dau","Chuß║⌐n":"Chuan","bß╗ï":"bi","m├┤i":"moi","tr╞░ß╗¥ng":"truong","ph├ít":"phat","triß╗ân":"trien","Kiß╗âm":"Kiem","kß║┐t":"ket","nß╗æi":"noi","giß╗»a":"giua","T├¡ch":"Tich","hß╗úp":"hop","v├áo":"vao","Xß╗¡":"Xu","l├╜":"ly","lß╗ùi":"loi","kiß╗âm":"kiem","thß╗¡":"thu","t├¡nh":"tinh","n─âng":"nang","Ho├án":"Hoan","th├ánh":"thanh",khai:"khai","Kß║┐t":"Ket","th├║c":"thuc"},e={à:"a",á:"a",ả:"a",ã:"a",ạ:"a",ă:"a",ắ:"a",ằ:"a",ẳ:"a",ẵ:"a",ặ:"a",â:"a",ấ:"a",ầ:"a",ẩ:"a",ẫ:"a",ậ:"a",è:"e",é:"e",ẻ:"e",ẽ:"e",ẹ:"e",ê:"e",ế:"e",ề:"e",ể:"e",ễ:"e",ệ:"e",ì:"i",í:"i",ỉ:"i",ĩ:"i",ị:"i",ò:"o",ó:"o",ỏ:"o",õ:"o",ọ:"o",ô:"o",ố:"o",ồ:"o",ổ:"o",ỗ:"o",ộ:"o",ơ:"o",ớ:"o",ờ:"o",ở:"o",ỡ:"o",ợ:"o",ù:"u",ú:"u",ủ:"u",ũ:"u",ụ:"u",ư:"u",ứ:"u",ừ:"u",ử:"u",ữ:"u",ự:"u",ỳ:"y",ý:"y",ỷ:"y",ỹ:"y",ỵ:"y",đ:"d",À:"A",Á:"A",Ả:"A",Ã:"A",Ạ:"A",Ă:"A",Ắ:"A",Ằ:"A",Ẳ:"A",Ẵ:"A",Ặ:"A",Â:"A",Ấ:"A",Ầ:"A",Ẩ:"A",Ẫ:"A",Ậ:"A",È:"E",É:"E",Ẻ:"E",Ẽ:"E",Ẹ:"E",Ê:"E",Ế:"E",Ề:"E",Ể:"E",Ễ:"E",Ệ:"E",Ì:"I",Í:"I",Ỉ:"I",Ĩ:"I",Ị:"I",Ò:"O",Ó:"O",Ỏ:"O",Õ:"O",Ọ:"O",Ô:"O",Ố:"O",Ồ:"O",Ổ:"O",Ỗ:"O",Ộ:"O",Ơ:"O",Ớ:"O",Ờ:"O",Ở:"O",Ỡ:"O",Ợ:"O",Ù:"U",Ú:"U",Ủ:"U",Ũ:"U",Ụ:"U",Ư:"U",Ứ:"U",Ừ:"U",Ử:"U",Ữ:"U",Ự:"U",Ỳ:"Y",Ý:"Y",Ỷ:"Y",Ỹ:"Y",Ỵ:"Y",Đ:"D"};let o=t;for(const[i,n]of Object.entries(r))o=o.replace(new RegExp(i,"g"),n);for(const[i,n]of Object.entries(e))o=o.replace(new RegExp(i,"g"),n);return o}function x(){c=new s.BrowserWindow({show:!1,webPreferences:{nodeIntegration:!0,contextIsolation:!1}});const t=g.createConnection({port:y,host:"localhost"},()=>{console.log("Connected to core");const r={type:"register-plugin",payload:{name:"export-to-pdf",version:"1.0.0",description:"Export text content to PDF",author:"Text Editor Team"}};t.write(JSON.stringify(r)),setTimeout(()=>{const e=[{id:"export-to-pdf.exportToPdf",label:"Export to PDF",parentMenu:"file",position:100,shortcut:"Ctrl+Shift+E"}],o={type:"register-menu",payload:{pluginName:"export-to-pdf",menuItems:e}};console.log("Registering menu items:",e),t.write(JSON.stringify(o))},1e3)});t.on("data",r=>{try{const e=JSON.parse(r.toString());if(console.log("Received message:",e),e.type==="execute-plugin"||e.type==="execute-menu-action"){const{content:o,filePath:i}=e.payload||{};if(console.log(`Received ${e.type} with content length: ${(o==null?void 0:o.length)||0}`),console.log(`File path: ${i||"none"}`),!i){console.error("Error: No file path provided"),t.write(JSON.stringify({type:"plugin-response",id:e.id,payload:{success:!1,message:"Error: No file path provided"}}));return}if(e.type==="execute-menu-action"){const{menuItemId:n}=e.payload||{};if(console.log(`Menu item ID: ${n}`),n!=="export-to-pdf.exportToPdf"){console.error(`Unknown menu item ID: ${n}`),t.write(JSON.stringify({type:"plugin-response",id:e.id,payload:{success:!1,message:`Unknown menu item ID: ${n}`}}));return}}try{const p=(o?O(o):"Không có nội dung").split(/\r?\n/),u={info:{title:"Exported Document",author:"Text Editor",subject:"Text Document",keywords:"text, document, export",creator:"PDF Export Plugin"},content:[{text:"Tài liệu xuất PDF",style:"header",alignment:"center"},`
`,...p.map(a=>({text:a,margin:[0,5,0,0]}))],defaultStyle:{font:"Roboto",fontSize:12},styles:{header:{fontSize:18,bold:!0,margin:[0,0,0,10]}}};l.createPdf(u).getBuffer(a=>{m.writeFileSync(i,a),console.log(`PDF exported to: ${i}`),t.write(JSON.stringify({type:"plugin-response",id:e.id,payload:{success:!0,message:`PDF exported to ${i}`,data:{filePath:i}}}))})}catch(n){console.error("Error creating PDF:",n),t.write(JSON.stringify({type:"plugin-response",id:e.id,payload:{success:!1,message:`Error creating PDF: ${n.message||"Unknown error"}`}}))}}}catch(e){console.error("Error processing message:",e)}}),t.on("error",r=>{console.error("Socket error:",r)}),t.on("end",()=>{console.log("Disconnected from core")}),c.loadURL("data:text/html,<html><body></body></html>")}s.app.whenReady().then(()=>{x()});s.app.on("window-all-closed",()=>{process.platform!=="darwin"&&s.app.quit()});
