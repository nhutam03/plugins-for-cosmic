"use strict";const a=require("electron"),p=require("fs"),f=require("net");function g(e){const o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(o,t,n.get?n:{enumerable:!0,get:()=>e[t]})}}return o.default=e,Object.freeze(o)}const h=g(p),l=require("pdfmake/build/pdfmake"),m=require("pdfmake/build/vfs_fonts");l.vfs=m.pdfMake.vfs;let c=null;const y=5e3;function O(e){const o={"Bß║»t":"Bat","─æß║ºu":"dau","Chuß║⌐n":"Chuan","bß╗ï":"bi","m├┤i":"moi","tr╞░ß╗¥ng":"truong","ph├ít":"phat","triß╗ân":"trien","Kiß╗âm":"Kiem","kß║┐t":"ket","nß╗æi":"noi","giß╗»a":"giua","T├¡ch":"Tich","hß╗úp":"hop","v├áo":"vao","Xß╗¡":"Xu","l├╜":"ly","lß╗ùi":"loi","kiß╗âm":"kiem","thß╗¡":"thu","t├¡nh":"tinh","n─âng":"nang","Ho├án":"Hoan","th├ánh":"thanh",khai:"khai","Kß║┐t":"Ket","th├║c":"thuc"},t={à:"a",á:"a",ả:"a",ã:"a",ạ:"a",ă:"a",ắ:"a",ằ:"a",ẳ:"a",ẵ:"a",ặ:"a",â:"a",ấ:"a",ầ:"a",ẩ:"a",ẫ:"a",ậ:"a",è:"e",é:"e",ẻ:"e",ẽ:"e",ẹ:"e",ê:"e",ế:"e",ề:"e",ể:"e",ễ:"e",ệ:"e",ì:"i",í:"i",ỉ:"i",ĩ:"i",ị:"i",ò:"o",ó:"o",ỏ:"o",õ:"o",ọ:"o",ô:"o",ố:"o",ồ:"o",ổ:"o",ỗ:"o",ộ:"o",ơ:"o",ớ:"o",ờ:"o",ở:"o",ỡ:"o",ợ:"o",ù:"u",ú:"u",ủ:"u",ũ:"u",ụ:"u",ư:"u",ứ:"u",ừ:"u",ử:"u",ữ:"u",ự:"u",ỳ:"y",ý:"y",ỷ:"y",ỹ:"y",ỵ:"y",đ:"d",À:"A",Á:"A",Ả:"A",Ã:"A",Ạ:"A",Ă:"A",Ắ:"A",Ằ:"A",Ẳ:"A",Ẵ:"A",Ặ:"A",Â:"A",Ấ:"A",Ầ:"A",Ẩ:"A",Ẫ:"A",Ậ:"A",È:"E",É:"E",Ẻ:"E",Ẽ:"E",Ẹ:"E",Ê:"E",Ế:"E",Ề:"E",Ể:"E",Ễ:"E",Ệ:"E",Ì:"I",Í:"I",Ỉ:"I",Ĩ:"I",Ị:"I",Ò:"O",Ó:"O",Ỏ:"O",Õ:"O",Ọ:"O",Ô:"O",Ố:"O",Ồ:"O",Ổ:"O",Ỗ:"O",Ộ:"O",Ơ:"O",Ớ:"O",Ờ:"O",Ở:"O",Ỡ:"O",Ợ:"O",Ù:"U",Ú:"U",Ủ:"U",Ũ:"U",Ụ:"U",Ư:"U",Ứ:"U",Ừ:"U",Ử:"U",Ữ:"U",Ự:"U",Ỳ:"Y",Ý:"Y",Ỷ:"Y",Ỹ:"Y",Ỵ:"Y",Đ:"D"};let n=e;for(const[r,i]of Object.entries(o))n=n.replace(new RegExp(r,"g"),i);for(const[r,i]of Object.entries(t))n=n.replace(new RegExp(r,"g"),i);return n}function E(){c=new a.BrowserWindow({show:!1,webPreferences:{nodeIntegration:!0,contextIsolation:!1}});const e=f.createConnection({port:y,host:"localhost"},()=>{console.log("Connected to core");const o={type:"register-plugin",payload:{name:"pdf-export",version:"1.0.0",description:"Export text content to PDF",author:"Text Editor Team"}};e.write(JSON.stringify(o))});e.on("data",o=>{try{const t=JSON.parse(o.toString());if(console.log("Received message:",t),t.type==="execute-plugin"){const{content:n,filePath:r}=t.payload||{};if(!r){console.error("Error: No file path provided"),e.write(JSON.stringify({type:"plugin-response",id:t.id,payload:{success:!1,message:"Error: No file path provided"}}));return}try{const d=(n?O(n):"Không có nội dung").split(/\r?\n/),u={info:{title:"Exported Document",author:"Text Editor",subject:"Text Document",keywords:"text, document, export",creator:"PDF Export Plugin"},content:[{text:"Tài liệu xuất PDF",style:"header",alignment:"center"},`
`,...d.map(s=>({text:s,margin:[0,5,0,0]}))],defaultStyle:{font:"Roboto",fontSize:12},styles:{header:{fontSize:18,bold:!0,margin:[0,0,0,10]}}};l.createPdf(u).getBuffer(s=>{h.writeFileSync(r,s),console.log(`PDF exported to: ${r}`),e.write(JSON.stringify({type:"plugin-response",id:t.id,payload:{success:!0,message:`PDF exported to ${r}`,data:{filePath:r}}}))})}catch(i){console.error("Error creating PDF:",i),e.write(JSON.stringify({type:"plugin-response",id:t.id,payload:{success:!1,message:`Error creating PDF: ${i.message||"Unknown error"}`}}))}}}catch(t){console.error("Error processing message:",t)}}),e.on("error",o=>{console.error("Socket error:",o)}),e.on("end",()=>{console.log("Disconnected from core")}),c.loadURL("data:text/html,<html><body></body></html>")}a.app.whenReady().then(()=>{E()});a.app.on("window-all-closed",()=>{process.platform!=="darwin"&&a.app.quit()});
